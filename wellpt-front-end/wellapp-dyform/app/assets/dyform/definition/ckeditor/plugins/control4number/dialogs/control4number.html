 
<div id="numberAttrCfgDiv" title='属性设置'  style=" height: 400px; overflow: auto;">
	<div> 
		<div class="dyform">
			<div class="post-sign">
				<div class="post-detail">
		<table>
			<tr>
				<td class="Label">字段编码</td>
				<td class="value"><input type="text"
					name="name" id="name" value="" class="w100"/>  
			</tr>
			<!--3 -->
			<tr class="odd">
				<td class="Label">显示名称</td>
				<td class="value"><input type="text" class="w100" name="displayName"
					id="displayName" value="" /></td>
			</tr>
		
			<!--1 --> 
			<tr>
				<td class="Label">应用于</td>
				<td class="value"><input type="text" class="w100" name="applyTo"
					id="applyTo" value="" /> </td>
			</tr>
			
			<tr class="odd">
				<td class="Label">默认值</td>
				<td class="value">
				<input type="text" value="0" name="defaultValue"  id="defaultValue" /> 
				</td>
			</tr>
			
			<tr>
				<td class="Label">数字类型</td>
				<td class="value">
					<select id="dbDataType" name="dbDataType" class="w100">
						<option value="13">  整数</option>
						<option value="131">  正整数</option>
						<option value="132">  负整数</option>
						<option value="14">  长整数</option>
						<option value="15">  浮点数</option>
						<option value="12">  双精度浮点数</option>
						<option value="17">  number类型</option>
					</select>
					<input type="text" value="7" name="length"  id="length" style="display: none;"/>
				</td>
			</tr> 
			
				<tr id="tr_decimal" style="display:none;">
				<td class="Label" >小数位数</td>
				<td class="value">
				<input type="text"  name="decimal"
					id="decimal" value="" style="width: 25px;float: left;"/>
				</td>
			</tr> 
			
			
			
			<tr id="tr_plusminus" class="odd">
				<td class="Label" >加减功能</td>
				<td class="value"> 
				 <label for="plusMark">加</label><input type="checkbox"  name="plusMark" 
					id="plusMark" value="" style="width: 50px; "/>
					单位:<input type="text"  name="plusUnit"
					id="plusUnit" value="1" style="width: 50px; "/>  
				 <label for="minusMark">减</label><input type="checkbox"  name="minusMark" 
					id="minusMark" value="" style="width: 50px; "/>
					单位:<input type="text"  name="minusUnit"
					id="minusUnit" value="1" style="width: 50px; "/>  
				</td>
			</tr>
			
			
			<tr id="tr_number" style="display: none;">
				<td class="Label" >位数</td>
				<td class="value" >
					<div class="tr_td_div_left">
						<span>精度位(有效数):</span><input type="text" name="precision" id="precision"/>
					</div>
					<div class="tr_td_div_left">
						<span>小数位:</span><input type="text" name="scale" id="scale"/>
					</div>
				</td>
			</tr>
				
			<tr>
				<td class="Label">字体样式</td>
				<td class="value">
				
				<div class="tr_td_div_left">
					<span id="fontcolorElement" class="fontColorCss" ></span>
					<input type="hidden" value="" id="fontColor">
					<div class="subcolorCss" id="subcolor" >
					<div style="display: none;" class="colors">
						<span onclick="selColor('black');" style="background-color:black;" class="selectcolor"></span>
						<span onclick="selColor('red');" style="background-color:red " class="selectcolor"></span>
						<span onclick="selColor('blue');" style="background-color:blue " class="selectcolor"></span>
						<span onclick="selColor('orange');" style="background-color:orange " class="selectcolor"></span>
						<span onclick="selColor('green');" style="background-color:green " class="selectcolor"></span>
						<span onclick="selColor('yellow');" style="background-color:yellow " class="selectcolor"></span>
						<span onclick="selColor('purple');" style="background-color:purple " class="selectcolor"></span>
						<span onclick="selColor('silver');" style="background-color:silver " class="selectcolor"></span>
						<span onclick="selColor('tan');" style="background-color:tan " class="selectcolor"></span>
						<span onclick="selColor('maroon');" style="background-color:maroon;" class="selectcolor"></span>
						<span onclick="selColor('olive');" style="background-color:olive;" class="selectcolor"></span>
						<span onclick="selColor('gray');" style="background-color:gray;" class="selectcolor"></span>
						<span onclick="selColor('lime');" style="background-color:lime;" class="selectcolor"></span>
					</div>
					</div>
				</div>
			 <div class="tr_td_div_left">
					<select name="fontSize" id="fontSize" style="display: block;float: left;width: 112px;">
						
						<option value="8" style="font-size:8px;">8</option>
						<option value="9" style="font-size:9px;">9</option>
						<option value="10" style="font-size:10px;">10</option>
						<option value="11" style="font-size:11px;">11</option>
						<option value="12" style="font-size:12px;" selected="selected">12</option>
						<option value="14" style="font-size:14px;">14</option>
						<option value="16" style="font-size:16px;">16</option>
						<option value="18" style="font-size:18px;">18</option>
						<option value="20" style="font-size:20px;">20</option>
						<option value="22" style="font-size:22px;">22</option>
						<option value="24" style="font-size:24px;">24</option>
						<option value="26" style="font-size:26px;">26</option>
						<option value="28" style="font-size:28px;">28</option>
						<option value="36" style="font-size:36px;">36</option>
						<option value="48" style="font-size:48px;">48</option>
						<option value="72" style="font-size:72px;">72</option>
					</select>
				</div>
				</td>
			</tr>
			
			
			<tr  class="odd">
				<td class="Label">控件样式</td>
				<td class="value">
				 
				<div class="tr_td_div_left">
					<span>宽度:</span><input type="text" name="ctlWidth" id="ctlWidth" />
				</div>
				<div class="tr_td_div_left">
					<span>高度:</span><input type="text" name="ctlHight" id="ctlHight" />
				</div>
				<div class="tr_td_div_left">
					<select name="textAlign" id="textAlign"  style="width: 100px;">
						<option value="">--对齐方式--</option>
						<option value="center">居中</option>
						<option value="left">靠左</option>
						<option value="right">靠右</option>
					</select>
				</div>
				</td>
			</tr>
			
			
 			<tr>
				<td class="Label">编辑模式</td>
				<td class="value"> 
					<div class="tr_td_div_left" style="padding-top: 9px;"> 
					<input type="radio" name="showType" value="1" checked="checked">可编辑
						<input type="radio" name="showType" value="3"> 只读
						<input type="radio" name="showType" value="2">显示文本
						<input type="radio" name="showType" value="4"> 禁用
						<input type="radio" name="showType" value="5"> 隐藏
					</div>
				</td>
			</tr>
			 
		
			
			<tr style="display: none;">
				<td class="Label">默认值</td>
				<td class="value">
					 <input type="hidden" value="" name="defaultValue"  id="defaultValue" /> 
				</td>
			</tr>
		
			 
			<tr class="odd" >
				<td class="Label">校验规则</td>
				<td class="value">
					<input type="checkbox" name="fieldCheckRules" id="checkRule_1" value="1"  onclick="checkMust(this)"/><label for="checkRule_1">非空</label>
					<input type="checkbox" name="fieldCheckRules" id="checkRule_5" value="5" onclick="checkUnique(this)" /><label for="checkRule_5">全局唯一</label>
					<input type="checkbox" name="fieldCheckRules" id="checkRule_6" value="5" onclick="checkUnitUnique(this)" /><label for="checkRule_6">单位内唯一</label>
					<input type="hidden" name="unitUnique" id="unitUnique" />
				</td>
			</tr>
			
				 
			<tr id="tr_onlyreadUrl" >
				<td class="Label">标识地址</td>
				<td class="value"><input type="text" id="onlyreadUrl" name="onlyreadUrl" />
				<br/>参数格式${fieldName},fieldName为表单字段名称。示例：https://www.baidu.com?pa=${pa}</td>
			</tr> 
			
			<tr id="tr_jsFormalu" style="display: none;">
				<td class="Label">运算公式</td>
				<td class="value"> 
					<textarea rows="10" cols="50" id="formula" name="formula"></textarea>
				</td>
			</tr> 

			<tr class="odd">
				<td class="Label">备注</td>
				<td class="value">
					 <input type="text" value="" name="note"  id="note" /> 
				</td>
			</tr>
			
		
			
		</table>
		
	</div>
	</div>
		</div>
		</div>
</div>
<script type="text/javascript">


var numberctl = {};
numberctl.$ =  function(selector){ 
	return $(selector, $("#numberAttrCfgDiv"));
} 

$.extend(numberctl, $.ControlConfigUtil);

$.extend(numberctl, {

	getFieldDefinition:function(fieldName){
		var field = null;
		field = formDefinition.fields[fieldName];//表单中从表的信息
		if(field == null ||  (typeof field) == "undefined"){
			field = new WNumberInputClass();
			field.inputMode =  dyFormInputMode.number;
			field.dbDataType = dyFormDataType["int"];
			field.decimal = '0';
			field.valueCreateMethod = dyFormInputValue.userImport;
		}else{
			var fieldCopy = {};
			$.extend(true, fieldCopy, field);//这里只是做了一个副本,只有当用户点击确定完之后方可改变formDefinition对应的field对象 
			field = fieldCopy;
		}
		return field; 
	},


	initProperty:function(field){
		  
		//控件属性初始化公共设置.
		this.ctlPropertyComInitSet(field);
		//私有属性
		this.$("#decimal").val(field.decimal);
		this.$("#precision").val(field.precision);
		this.$("#scale").val(field.scale);
		var _this = this;
		this.$("#dbDataType").change(function(){
			var value=_this.$("#dbDataType").val();
			if(value=='13'){
				_this.$("#length").val('9');
				_this.$("#tr_decimal").hide();
				_this.$("#decimal").val('0'); 
				_this.$("#tr_number").hide();
			}else if(value=='14'){
				_this.$("#length").val('16');
				_this.$("#tr_decimal").hide();
				_this.$("#decimal").val('0'); 
				_this.$("#tr_number").hide();
			}else if(value=='15'){
				_this.$("#length").val('12');
				_this.$("#tr_decimal").show();
				_this.$("#decimal").val('2');
				_this.$("#tr_number").hide();
			}else if(value=='12'){
				_this.$("#length").val('18');
				_this.$("#tr_decimal").show();
				_this.$("#decimal").val('2');
				_this.$("#tr_number").hide();
			}else if(value=='17'){
				_this.$("#tr_decimal").hide();
				_this.$("#tr_number").show();
			}
		});
		
		
		if(field.dbDataType=='15' || field.dbDataType=='12'){
			this.$("#tr_decimal").show();
			this.$("#decimal").val(field.decimal);
		}else {
			this.$("#tr_decimal").hide();
		}
		if(field.dbDataType=='17'){
			_this.$("#tr_number").show();
		}
		if(field.formula)
		this.$("#formula").text(field.formula); 
		this.setOperatorValue(field.operator);
		
		
	},

	setOperatorValue:function(operator){
		if(typeof operator == "undefined"){
			operator = new NumberOperator(); 
		}
		this.$("#plusMark").attr("checked", operator.plus );
		this.$("#minusMark").attr("checked", operator.minus );
		this.$("#plusUnit").val(operator.plusUnit); 
		this.$("#minusUnit").val(operator.minusUnit);
	},


	getOperatorValue:function(dbDataType){
		var operator = new NumberOperator();
		operator.plus = this.$("#plusMark").attr("checked" ) == "checked";
		operator.minus = this.$("#minusMark").attr("checked") == "checked";
		operator.plusUnit = this.$("#plusUnit").val();
		operator.minusUnit = this.$("#minusUnit").val(); 
		
		//number小数位
		var scale = this.$("#scale").val();
		var precision = this.$("#precision").val();
		if(dbDataType == '17'){
			if(scale && isNaN(scale)){
				alert("小数位须为数字");
				throw new Error("小数位须为数字");
			}
			if(parseInt(scale)>127 || parseInt(scale)<-84){
				alert("小数位须为-84-127");
				throw new Error("小数位须为-84-127");
			}
			if(precision && isNaN(precision)){
				alert("精度位须为数字");
				throw new Error("整数位须为数字");
			}
			if(parseInt(precision)>38 || parseInt(precision)<0){
				alert("精度位须为1-38");
				throw new Error("精度位须为1-38");
			}
		}
		if((operator.minus && isNaN(operator.minusUnit)) ||(operator.plus && isNaN(operator.plusUnit))){
			alert("加量、减量须为数字");
			throw new Error("减量须为数字");
		}
		
		
		if(operator.plusUnit != "" && operator.plus  ){
			if(dbDataType == dyFormDataType["float"] || dbDataType == dyFormDataType["double"]){
				try{
					operator.plusUnit = parseFloat(operator.plusUnit);
				}catch (e) {
					alert("加量须为小数");
					throw new Error("加量须为小数");
				}
			}else{
				try{
					operator.plusUnit = parseInt(operator.plusUnit);
				}catch (e) {
					alert("加量须为整数");
					throw new Error("加量须为整数");
				}
			}
			
			
		}
		
		// alert(this.$("#plusMark").attr("checked" ) + ":" + ("checked" == this.$("#plusMark").attr("checked" )) + ":" + isNaN(operator.plusUnit) );
		 
		if(operator.minusUnit != "" && operator.minus  ){
			if(dbDataType == dyFormDataType["float"] || dbDataType == dyFormDataType["double"]){
				try{
					operator.minusUnit = parseFloat(operator.minusUnit);
				}catch (e) {
					alert("减量须为小数");
					throw new Error("减量须为小数");
				}
			}else{
				try{
					operator.minusUnit = parseInt(operator.minusUnit);
				}catch (e) {
					alert("减量须为整数");
					throw new Error("减量须为整数");
				}
			}
			
			
		}
		 
		 
		return operator;
	},
	
	

	collectFormAndFillCkeditor:function(){
		var field = this.field;
		field.inputMode =  dyFormInputMode.number; 
		//控件公共属性收集
		var checkpass=this.collectFormCtlComProperty(field);
		field.operator = this.getOperatorValue(field.dbDataType);
	 
		if(field.operator.plus || field.operator.minus){//如果有加减功能，则需要设置控件的宽度
			if($.trim(field.ctlWidth).length == 0){
				field.ctlWidth = "50";
			}
			if($.trim(field.ctlHight).length == 0){
				field.ctlHight = "13";
			}
		}
	 	
		if(!checkpass){
			return false;
		}
		field.decimal = this.$("#decimal").val();
		field.formula = this.$("#formula").val();
		//number精度位
		field.precision = this.$("#precision").val();
		//number小数位
		field.scale = this.$("#scale").val();
		//创建控件占位符
		this.createControlPlaceHolder(this,this.editor.imageOfNumberctl,field);
		formDefinition.addField(field.name, field);
		//添加校验规则
		//field.contentFormat=$("#dbDataType").val();
		//field.fieldCheckRules=new Array;
		//field.fieldCheckRules.push({value:'n'+field.contentFormat, label:$("#dbDataType").find("option:selected").text()});
		return true;
	}
});


</script>