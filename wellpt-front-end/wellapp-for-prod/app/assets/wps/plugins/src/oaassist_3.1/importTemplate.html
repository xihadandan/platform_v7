<!DOCTYPE html>
<html lang="en">

<head>
    <title>导入正文模板</title>
    <meta charset="UTF-8">

    <link rel="stylesheet" type="text/css" href="./plugin/css/iview.css">
    <link rel="stylesheet" type="text/css" href="./plugin/vendor/zTree3.3/css/bootstrapStyle/bootstrapStyle.css">
    <script type="text/javascript" src="./plugin/js/vue.min.js"></script>
    <script type="text/javascript" src="./plugin/js/iview.min.js"></script>
    <script type="text/javascript" src="./plugin/js/config.js"></script>
    <script type="text/javascript" src='./js/common.js'></script>
    <!--<script type="text/javascript" src='./js/module/selectTemplate.js'></script>-->
    <script type="text/javascript" src='js/function/importTemplate.js'></script>
    <script type="text/javascript" src='./js/main.js'></script>

</head>

<body>
<div id="template" style="margin: 0 auto;">

    <Card :bordered="false" style="height:110px ">
        <div style="margin: 10px auto">

            <p style=" padding-top: 5px">文件名：</p>

            <i-select v-model="templateItem" placeholder="选择模板">
                <i-option v-for="(item,key) in templates" :value="item.tempId" :key="key">{{item.tempName}}</i-option>
            </i-select>

        </div>

    </Card>

    <div align="right" style="border-bottom:1px ;padding: 10px;margin-top:180px">

        <i-button size="large" type="primary " @click="wps.ExecFunc('onImportTemplate()')">导入</i-button>
        <i-button size="large" type="primary " @click="cancel">取消</i-button>
    </div>

</div>
</body>

<script>
    function getDocTemplateListFromWeb() {
        var storage = wps.PluginStorage;
        var templatePath = storage.getItem("templatePath");
        $.ajax({
            url: templatePath || OA_DOOR.templatePath,
            // url: templatePath,//从前台传入模板列表路径
            async: false,
            method: "post",
            dataType: 'json',
            success: function (res) {
                console.log(JSON.stringify(res));
                vueszgd.templates = res;
                // alert(JSON.stringify(res));
            },
            error: function (res) {
                alert("获取响应失败");
                vueszgd.templates = {}
            }

        });

    }

    function onImportTemplate() {
        var storage = wps.PluginStorage;
        var getTemplatePath = storage.getItem("getTemplatePath");
        var templateId = JSON.stringify(vueszgd.templateItem);
        var templateURL;
        if (getTemplatePath !== null && getTemplatePath !== "") {
            templateURL = getTemplatePath+ templateId;
        }else{
            templateURL = OA_DOOR.templateBaseURL+ templateId;
        }

        alert(templateURL)
        importTemlateFile(templateURL);

        window.opener = null;
        window.open('', '_self', '');
        window.close();
    }

    function getTemplateLists() {
        getDocTemplateListFromWeb();
        
    }

    var vueszgd = new Vue({
        el: '#template',
        data: {
            templateItem: {},
            templates: {},
            templatePath: ""

        },
        methods: {
            cancel: function () {
                window.close();
            }
        },
        mounted: function () {
            wps.ExecFunc('getTemplateLists()');

        }

    });
</script>

<style media="screen" type="text/css" scoped>

</style>

</html>